# CMS Detector

A Go library for detecting and identifying various CMS (Cryptographic Message Syntax) and PKCS (Public Key Cryptography Standards) formats.

## Installation

```bash
go get github.com/lEx0/cmsdetector
```

## Features

- Detection of various PKCS#7 (CMS) structures:
    - PKCS#7 Data
    - PKCS#7 Signed Data
    - PKCS#7 Enveloped Data
    - PKCS#7 Signed And Enveloped Data
    - PKCS#7 Digested Data
    - PKCS#7 Encrypted Data
- Basic verification of PKCS#12 containers
- Extraction of CMS structure metadata
- Full compatibility with KalkanCrypt (Kazakhstan's national cryptographic provider) formats and standards

## Usage Example

```go
package main

import (
	"fmt"
	"os"

	"github.com/lEx0/cmsdetector"
)

func main() {
	data, err := os.ReadFile("test.cms")
	if err != nil {
		fmt.Printf("Error reading file: %s\n", err)
		return
	}
	
	// Main method for type detection
	result, err := cmsdetector.Detect(data)
	if err != nil {
		fmt.Printf("Analysis error: %s\n", err)
		return
	}
	
	fmt.Printf("File type: %s\n", result.Type)
	fmt.Printf("OID: %s\n", result.ContentType.String())
	
	// Check for specific type
	if cmsdetector.IsPKCS7SignedData(data) {
		fmt.Println("File contains PKCS#7 signed data")
	}
}
```

## Specialized Checks

```go
// Check for PKCS#7 SignedData
if cmsdetector.IsPKCS7SignedData(data) {
    fmt.Println("Found signed data")
}

// Check for PKCS#7 EnvelopedData
if cmsdetector.IsPKCS7EnvelopedData(data) {
    fmt.Println("Found encrypted data")
}

// Check for PKCS#12
if cmsdetector.IsPKCS12(data) {
    fmt.Println("Found PKCS#12 container")
}
```

## Limitations

- The library only performs type detection of CMS/PKCS data, not full parsing or validation
- For PKCS#12 containers, basic structure verification is performed, but not content decryption

## KalkanCrypt Compatibility

This library is designed to work with files created by KalkanCrypt, the national cryptographic provider in Kazakhstan. It can detect and identify various cryptographic formats generated by KalkanCrypt, including:

- CMS/PKCS#7 signed data (digital signatures)
- PKCS#12 (.p12) key containers
- Other KalkanCrypt-specific cryptographic formats

This makes the library particularly useful for applications that need to interoperate with the KalkanCrypt ecosystem.

## License

MIT
